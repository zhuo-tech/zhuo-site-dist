<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Javascript 构造函数、new、bind()、call() 原理理解 | 灼灼前端</title>
    <meta name="generator" content="VuePress 1.8.0">
    
    <meta name="description" content="移动端App开发网页:Flutter 原生跨端开发、Flutter 集成 Android & iOS 混合开发，丝滑高帧的用户体验。小程序开发:JS/TS、Vue、React、Uni-app 多端开发，小游戏、Three.js 3D、车联网地图应用。三方技术顾问:项目报价、合同、风险，项目管理、跟进与协调、验收；系统运维、压力测试。">
    <meta name="baidu-site-verification" content="code-GLMGFYoFh6">
    
    <link rel="preload" href="/assets/css/0.styles.7659f3c6.css" as="style"><link rel="preload" href="/assets/js/app.0ba7f43e.js" as="script"><link rel="preload" href="/assets/js/8.8fe45a55.js" as="script"><link rel="preload" href="/assets/js/1.2d515849.js" as="script"><link rel="preload" href="/assets/js/25.a6430ad1.js" as="script"><link rel="prefetch" href="/assets/js/10.70ee330d.js"><link rel="prefetch" href="/assets/js/11.9a517545.js"><link rel="prefetch" href="/assets/js/12.b3d78d9c.js"><link rel="prefetch" href="/assets/js/13.19acdff0.js"><link rel="prefetch" href="/assets/js/14.39ceab07.js"><link rel="prefetch" href="/assets/js/15.af69e1fe.js"><link rel="prefetch" href="/assets/js/16.d20572e3.js"><link rel="prefetch" href="/assets/js/17.1e25eef3.js"><link rel="prefetch" href="/assets/js/18.5c1cd5e9.js"><link rel="prefetch" href="/assets/js/19.fa6002d0.js"><link rel="prefetch" href="/assets/js/20.f9b868f4.js"><link rel="prefetch" href="/assets/js/21.fc723abd.js"><link rel="prefetch" href="/assets/js/22.e721e36b.js"><link rel="prefetch" href="/assets/js/23.70157ced.js"><link rel="prefetch" href="/assets/js/24.bb0911e9.js"><link rel="prefetch" href="/assets/js/26.83e2cc3e.js"><link rel="prefetch" href="/assets/js/27.6058922f.js"><link rel="prefetch" href="/assets/js/28.77e7e8f0.js"><link rel="prefetch" href="/assets/js/29.b7c2dcc4.js"><link rel="prefetch" href="/assets/js/3.5eef70fb.js"><link rel="prefetch" href="/assets/js/30.1b0ecbdc.js"><link rel="prefetch" href="/assets/js/31.19b7e0c5.js"><link rel="prefetch" href="/assets/js/32.6eee722d.js"><link rel="prefetch" href="/assets/js/33.58e00e54.js"><link rel="prefetch" href="/assets/js/34.746f015b.js"><link rel="prefetch" href="/assets/js/35.8f20e914.js"><link rel="prefetch" href="/assets/js/36.70533f68.js"><link rel="prefetch" href="/assets/js/37.3aa121fc.js"><link rel="prefetch" href="/assets/js/38.cd127ab8.js"><link rel="prefetch" href="/assets/js/39.ca650a41.js"><link rel="prefetch" href="/assets/js/4.a8aeca64.js"><link rel="prefetch" href="/assets/js/40.0c650fd3.js"><link rel="prefetch" href="/assets/js/41.0ea1abd2.js"><link rel="prefetch" href="/assets/js/42.9ab2e744.js"><link rel="prefetch" href="/assets/js/43.75e6f56c.js"><link rel="prefetch" href="/assets/js/44.526194c2.js"><link rel="prefetch" href="/assets/js/5.9ccab7e1.js"><link rel="prefetch" href="/assets/js/6.fe151a09.js"><link rel="prefetch" href="/assets/js/7.4294dc96.js"><link rel="prefetch" href="/assets/js/9.a08196e9.js">
    <link rel="stylesheet" href="/assets/css/0.styles.7659f3c6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="global-layout"><div data-v-623b3d5a><div class="theme-container no-sidebar" data-v-0c77f194 data-v-623b3d5a><header class="navbar" data-v-0c77f194><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="灼灼前端" class="logo"> <span class="site-name can-hide">灼灼前端</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/categories/" class="nav-link">
  博客
</a></div> <!----></nav></div></header> <div class="main-layout" data-v-0c77f194 data-v-623b3d5a><div class="left-part" data-v-0c77f194 data-v-623b3d5a></div> <div class="right-part" data-v-0c77f194 data-v-623b3d5a><main class="container px-2 md:px-10 lg:pl-20 mx-auto " data-v-7dd611ab data-v-623b3d5a> <div class="text-center pt-4" data-v-7dd611ab><div class="text-2xl md:text-3xl font-light " data-v-7dd611ab>Javascript 构造函数、new、bind()、call() 原理理解</div> <div class="flex justify-center text-sm text-gray-400 flex-wrap mt-6" data-v-7dd611ab><div data-v-7dd611ab>
        分类于
        <span class="pr-2" data-v-7dd611ab><a href="/categories/javascript/" class="underline" data-v-7dd611ab>Javascript</a></span></div> <div class="ml-2" data-v-7dd611ab>
        发表于
        <span class="text-gray-600 border-b border-dashed border-gray-400 cursor-not-allowed" data-v-7dd611ab>2018-02-28</span></div> <div class="ml-2" data-v-7dd611ab>
        作者:
        <span class="text-gray-600 border-b border-dashed border-gray-400 cursor-not-allowed" data-v-7dd611ab>灼灼团队</span></div> <div class="ml-3" data-v-7dd611ab>
        本文字数:
        <span class="text-gray-500" data-v-7dd611ab>
          2267
        </span></div> <div class="ml-3" data-v-7dd611ab>
        阅读时长 ≈
        <span data-v-7dd611ab> 7.6 分钟 </span></div></div></div> <div class="mt-10" data-v-7dd611ab><div class="content content__default" data-v-7dd611ab><p>其它语言开发者初接触 Js 时，会对构造函数、new 关键字有些迷糊，因为这两个概念在其它 OO 语言中是很基本的概念，但在 Js 中用起来和在以前熟悉的语言中有些不一样，引起一些困惑。</p> <h3 id="问题"><a href="#问题" class="header-anchor">#</a> 问题</h3> <p>在 C++/Java/PHP 中都有 class 的概念，class 有构造函数以及通过 new 实例化对象看起来都很理所当然，没什么可疑惑的。</p> <p>为什么会对 Js 中的 <code>new</code> <code>构造函数</code>就会产生一些疑惑呢，因为我们对这两个概念先入为主了。</p> <p>我们先抛开一般 OO 语言中的 class 等这些语法、概念，从更 “原始” 的角度去理解这两个概念及其作用，理解起来就变得非常简单。</p> <h3 id="构造函数"><a href="#构造函数" class="header-anchor">#</a> 构造函数</h3> <p><code>构造函数</code> 在 C++/java/PHP 中构造函数在形式上比较特殊，它们需要定义在一个 class 中，并且往往还有固定的函数名等。</p> <p>抛开这些说，<code>构造函数</code> 首先是一个函数，这个函数基本作用是用来初始化一个实例对象。</p> <p>在 Js 中，构造函数就是一个普通函数，它的定义也和普通的函数一样:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>那么我们要怎么用这个函数 <code>Person</code> 来初始化一个对象呢？
这就要提到 <code>执行环境</code> 这个概念了，也就是 <code>Person</code> 函数中的 <code>this</code> 关键字，它就代表当前函数执行时的 <code>执行环境</code>，在这里也就是我们要初始化的那个对象。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token function">Person</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">'laogen'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>   <span class="token comment">// {name: 'laogen'}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>这段代码就实现了——调用 <code>Person</code> 这个函数初始化了 <code>obj</code> 这个对象。
也就是说，我们通过 <code>call</code> 调用函数，第一个参数就是该函数的 <code>执行环境</code>，也就是 <code>Person</code> 中的 <code>this</code>。</p> <p>但上面这段实例化对象的代码 “不好看”，不像在 Java/C++ 中直接使用 <code>new</code> 来的简洁，我们用以下代码来模拟实现一个类似 Java/C++ 的实例化语法：</p> <ul><li>指定一个构造函数及其参数</li> <li>返回一个实例化的对象</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">New</span><span class="token punctuation">(</span><span class="token parameter">constructor<span class="token punctuation">,</span> <span class="token operator">...</span>args</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token function">constructor</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token punctuation">)</span>
    <span class="token keyword">return</span> obj
<span class="token punctuation">}</span>
<span class="token comment">// 用法如下</span>
<span class="token keyword">let</span> obj3 <span class="token operator">=</span> <span class="token function">New</span><span class="token punctuation">(</span>Person<span class="token punctuation">,</span> <span class="token string">'laogen3'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj3<span class="token punctuation">)</span>   <span class="token comment">// { name: 'laogen3' }</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>这个用法看起来就很 “像” Java/C++/PHP 中实例化一个对象的用法了。</p> <p>当然，在 Js 中有同样简洁的方式创建和初始化一个实例：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> obj2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">'laogen2'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj2<span class="token punctuation">)</span>    <span class="token comment">// { name: 'laogen2' }</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>到这里，你肯定就明白 <code>new</code> 一个构造函数到底是怎么回事了。你可以把 <code>new</code> 理解为一个语法糖，其实际工作就是我们上面模拟的 <code>New</code> 函数所做的。</p> <p>也就是说 <code>new</code> 关键字首先创建了一个对象，然后调用 <code>Person</code> 函数初始化这个对象。</p> <p>另外一个问题，我们直接调用构造函数 <code>Person()</code> 而不用 <code>new</code> 来调用会是什么样呢？ <code>Person()</code> 里面的 <code>this</code> 到底指向什么对象呢？</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name
<span class="token punctuation">}</span>
<span class="token function">Person</span><span class="token punctuation">(</span><span class="token string">'laogen4'</span><span class="token punctuation">)</span>
<span class="token function">console</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>  <span class="token comment">// &quot;laogen4&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>我们直接调用 <code>Person()</code> 而不通过 <code>new</code> 调用，结果就是在当前执行环境中创建并初始化了 <code>name</code> 属性，所以直接打印 <code>name</code> 输出了 <code>&quot;laogen4&quot;</code>。</p> <p>也就是说，如果我们直接调用 <code>Person()</code>，那么它的 <code>this</code> 就指向这个函数调用所在的执行环境，如果是在全局环境中调用的，那么这个执行环境： 在 Node.js 中就是 <code>global</code> 对象；在浏览器中通常是 <code>window</code> 对象。</p> <h3 id="this-call"><a href="#this-call" class="header-anchor">#</a> this &amp; call()</h3> <p>我们上面是通过调用 <code>call</code> 函数来完成的，那这个 call 又是怎么实现的呢？</p> <p>这个 <code>call</code> 函数当然是 Js 本身就支持的，我们通过下面代码模拟实现它，以便更好的理解其原理，因为 <code>this</code> 是 Js 关键字，不可用做标识符，我们用 <code>that</code> 来模拟代替 <code>this</code>:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 在这里约定最后一个参数是 `that`</span>
    <span class="token keyword">let</span> that <span class="token operator">=</span> arguments<span class="token punctuation">[</span>arguments<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span>
    that<span class="token punctuation">.</span>name <span class="token operator">=</span> name
<span class="token punctuation">}</span>
Person<span class="token punctuation">.</span><span class="token function-variable function">call</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">that<span class="token punctuation">,</span> <span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">Person</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">,</span> that<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> obj3 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token function">Person</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj3<span class="token punctuation">,</span> <span class="token string">'laogen3'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj3<span class="token punctuation">)</span>   <span class="token comment">// { name: 'laogen3' }</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>通过这段代码可以看出， <code>call()</code> 把它的第一个参数以某种方式传给了被调用的函数 <code>Person()</code>，并作用 <code>Person()</code> 函数的 <code>this</code> （也就是代码中的 <code>that</code>)。</p> <p>这段代码只是模拟过程，实际上 <code>this</code> 对象并不是通过被调用函数的最后一个传数来传递的，这个是 Js 编译器层面去实现的，这里不细究。</p> <h3 id="bind"><a href="#bind" class="header-anchor">#</a> bind()</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name
<span class="token punctuation">}</span>

<span class="token function">Person</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> <span class="token operator">...</span>args</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">Person</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> obj4 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">let</span> func <span class="token operator">=</span> <span class="token function">Person</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>obj4<span class="token punctuation">,</span> <span class="token string">'laogen4'</span><span class="token punctuation">)</span>
<span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj4<span class="token punctuation">)</span>  <span class="token comment">// { name: 'laogen4' }</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>这段代码模拟实现了 <code>bind()</code> 函数的逻辑，<code>bind()</code> 与 <code>call()</code> 的区别在于： <code>bind()</code> 并不调用 <code>Person()</code> 函数，它只是返回一个新函数，在这个新函数里调用了 <code>call()</code>。</p> <h3 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h3> <p>这篇文主要说明了 Js 构造函数只是普通的函数，和其它 OO 语言不同的是，它并没有很特别的地方，构造函数的主要作用就是初始化实例对象；</p> <p>通过模拟代码解释了 <code>new</code> 关键字的内部逻辑，以更好的理解构造函数的工作原理；</p> <p>通过模拟 <code>this</code> 更进一步的理解 <code>执行环境</code> 的概念；</p> <p>通过模拟 <code>call()</code> 和 <code>bind()</code> 方法，更直观深入的理解两者的逻辑和使用；</p></div></div> <footer class="page-edit" data-v-7dd611ab><!----> <!----></footer> <!----> </main></div></div> <div class="sidebar-mask" data-v-0c77f194></div> <aside class="sidebar" data-v-0c77f194><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/categories/" class="nav-link">
  博客
</a></div> <!----></nav>  <!----> </aside> <div class="footer-wrap py-20 bg-gray-500" data-v-717d1cf8 data-v-0c77f194><div class="w-full text-center text-white" data-v-717d1cf8>
    合肥灼灼信息技术有限公司
  </div> <div class="w-full text-center text-white mt-2" data-v-717d1cf8>
    Copyright © 2020-present zhuo-zhuo.com
  </div> <div class="w-full text-center  mt-2" data-v-717d1cf8><a href="https://beian.miit.gov.cn/" target="blank" class="text-gray-300 text-sm" data-v-717d1cf8>皖ICP备20009670号-2</a></div></div></div></div></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.0ba7f43e.js" defer></script><script src="/assets/js/8.8fe45a55.js" defer></script><script src="/assets/js/1.2d515849.js" defer></script><script src="/assets/js/25.a6430ad1.js" defer></script>
  </body>
</html>
