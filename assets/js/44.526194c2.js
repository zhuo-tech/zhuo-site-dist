(window.webpackJsonp=window.webpackJsonp||[]).push([[44],{550:function(s,t,a){"use strict";a.r(t);var n=a(44),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("通过一个 Hello World 示例来介绍 V8 的几个重要概念。")]),s._v(" "),a("p",[s._v("这个示例代码是基于 V8 (7.1) 的，要编译这个示例请查看 {% post_link v8/compile-v8 Javascript Engine V8 Embedding - 编译 %}")]),s._v(" "),a("h3",{attrs:{id:"示例代码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#示例代码"}},[s._v("#")]),s._v(" 示例代码")]),s._v(" "),a("div",{staticClass:"language-cpp line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-cpp"}},[a("code",[a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[s._v("#")]),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("<stdio.h>")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[s._v("#")]),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("<stdlib.h>")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[s._v("#")]),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("<string.h>")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[s._v("#")]),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"include/libplatform/libplatform.h"')])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[s._v("#")]),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"include/v8.h"')])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" argc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("char")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" argv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 初始化 V8")]),s._v("\n  v8"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V8")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("InitializeICUDefaultLocation")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("argv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  v8"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V8")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("InitializeExternalStartupData")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("argv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  std"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),s._v("unique_ptr"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("v8"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),s._v("Platform"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" platform "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" v8"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),s._v("platform"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("NewDefaultPlatform")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  v8"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V8")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("InitializePlatform")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("platform"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  v8"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V8")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("Initialize")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 创建一个 Isolate 实例, 它代表一个 JS VM 实例")]),s._v("\n  v8"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),s._v("Isolate"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),s._v("CreateParams create_params"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  create_params"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("array_buffer_allocator "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\n      v8"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),s._v("ArrayBuffer"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Allocator")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("NewDefaultAllocator")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  v8"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),s._v("Isolate"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" isolate "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" v8"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Isolate")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("New")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("create_params"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 使用 isolat\be")]),s._v("\n    v8"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),s._v("Isolate"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),s._v("Scope "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("isolate_scope")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("isolate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 创建一个 HandleScope，用于管理 Handle 的生命周期")]),s._v("\n    v8"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),s._v("HandleScope "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("handle_scope")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("isolate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 创建 Context，它是 javascript 代码执行的环境上下文对象")]),s._v("\n    v8"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),s._v("Local"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("v8"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),s._v("Context"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" context "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" v8"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Context")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("New")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("isolate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 进入 or 使用 context")]),s._v("\n    v8"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),s._v("Context"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),s._v("Scope "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("context_scope")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 定义 JS 代码字符串")]),s._v("\n      v8"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),s._v("Local"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("v8"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),s._v("String"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" source "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\n          v8"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("NewFromUtf8")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("isolate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"'Hello' + ', World!'\"")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                                  v8"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),s._v("NewStringType"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),s._v("kNormal"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ToLocalChecked")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 编译 JS 代码")]),s._v("\n      v8"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),s._v("Local"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("v8"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),s._v("Script"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" script "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\n          v8"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Script")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("Compile")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" source"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ToLocalChecked")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 运行 JS 代码，并获取结果")]),s._v("\n      v8"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),s._v("Local"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("v8"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),s._v("Value"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" result "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" script"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("Run")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ToLocalChecked")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 将运行结果转换为 UTF8 字符串，并打印")]),s._v("\n      v8"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),s._v("String"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),s._v("Utf8Value "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("utf8")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("isolate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("printf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%s\\n"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("utf8"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 释放 V8 相关资源")]),s._v("\n  isolate"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("Dispose")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  v8"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V8")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("Dispose")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  v8"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("V8")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("::")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ShutdownPlatform")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("delete")]),s._v(" create_params"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("array_buffer_allocator"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br")])]),a("h3",{attrs:{id:"v8-重要概念"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#v8-重要概念"}},[s._v("#")]),s._v(" V8 重要概念")]),s._v(" "),a("h4",{attrs:{id:"isolate"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#isolate"}},[s._v("#")]),s._v(" Isolate")]),s._v(" "),a("p",[s._v("一个 Isolate 就是一个 VM 实例，它有自己独立的 Heap。")]),s._v(" "),a("h4",{attrs:{id:"handle"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#handle"}},[s._v("#")]),s._v(" Handle")]),s._v(" "),a("p",[s._v("一个 "),a("code",[s._v("Handle")]),s._v(" 就是对一个 V8 object 的引用， V8 objects 都是分配在 Heap 中的，所有 V8 objects 都需要通过一个"),a("code",[s._v("Handle")]),s._v(" 引用来访问，才能保证 V8 garbage collector 能工作。")]),s._v(" "),a("p",[a("code",[s._v("Handle")]),s._v(" 又分 "),a("code",[s._v("Local")]),s._v("（局部） 和 "),a("code",[s._v("Persistent")]),s._v("（全局）两种。")]),s._v(" "),a("p",[a("code",[s._v("Local Handle")]),s._v(" 的生命周期 使用 "),a("code",[s._v("HandleScope")]),s._v(" 来管理，而 "),a("code",[s._v("Persistent")]),s._v(" 是全局的 "),a("code",[s._v("Handle")]),s._v("， 需要通过 "),a("code",[s._v("Persistent::New()")]),s._v(" 和 "),a("code",[s._v("Persistent::Release()")]),s._v(" 来创建和释放。")]),s._v(" "),a("h4",{attrs:{id:"handle-scope"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#handle-scope"}},[s._v("#")]),s._v(" Handle Scope")]),s._v(" "),a("p",[s._v("一个 "),a("code",[s._v("Handle Scope")]),s._v(" 可以理解为用来批量管理 "),a("code",[s._v("Handle")]),s._v(" 的容器，这样我们就不用一个个的去释放 "),a("code",[s._v("Handle")]),s._v("，只要把它们的 "),a("code",[s._v("Handle Scope")]),s._v(" 释放掉就可以了。")]),s._v(" "),a("p",[a("code",[s._v("Handle Scope")]),s._v(" 相当于提供了 "),a("code",[s._v("Handle Stack")]),s._v(" 机制来管理 Handles，当一个 "),a("code",[s._v("Handle Scope")]),s._v(" 本身被释放的时候，会从 "),a("code",[s._v("Handle Stack")]),s._v(" 上弹出所有基于它的 "),a("code",[s._v("Local Handles")]),s._v("。")]),s._v(" "),a("p",[s._v("注意：这个 "),a("code",[s._v("Handle Stack")]),s._v(" 并不是 "),a("code",[s._v("C++ 调用栈")]),s._v("， "),a("code",[s._v("Handle Scope")]),s._v(" 是在 "),a("code",[s._v("C++ 调用栈")]),s._v(" 中的分配的，"),a("code",[s._v("Handle Scope")]),s._v(" 必须创建在栈上，不能用 "),a("code",[s._v("new")]),s._v(" 创建！")]),s._v(" "),a("p",[s._v("{% img https://v8.dev/_img/docs/embed/local-persist-handles-review.png %}")]),s._v(" "),a("h4",{attrs:{id:"context"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#context"}},[s._v("#")]),s._v(" Context")]),s._v(" "),a("p",[a("code",[s._v("Context")]),s._v(" 是 javascript 代码的执行环境；")]),s._v(" "),a("p",[s._v("想像一下，你有多个不相关的 js 代码要运行，这些代码运行的过程中可能会修改 V8 全局的一些状态，就需要给他们指定不同的 "),a("code",[s._v("context")]),s._v(" 才能相互独立的隔离运行。")]),s._v(" "),a("p",[s._v("另外，我们可以为一个 "),a("code",[s._v("context")]),s._v(" 设置预定义的全局属性，这个属性可以是 C++ 写的对象或方法，这样在 js 环境中，就能够调用 C++ 对象了，相当于扩充了 js 的能力。")]),s._v(" "),a("p",[s._v("比如，"),a("code",[s._v("Node.js")]),s._v(" 中的 "),a("code",[s._v("process")]),s._v(" 对象，就是一个预定义到 "),a("code",[s._v("context")]),s._v(" 的对象，所以在 "),a("code",[s._v("Node.js")]),s._v(" 中可以直接使用。同样的，浏览器中的 "),a("code",[s._v("window")]),s._v(" "),a("code",[s._v("document")]),s._v(" 等全局对象，也是预定义到 "),a("code",[s._v("context")]),s._v(" 上的。")]),s._v(" "),a("h3",{attrs:{id:"参考链接"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考链接"}},[s._v("#")]),s._v(" 参考链接")]),s._v(" "),a("p",[s._v("Getting started with embedding V8: https://v8.dev/docs/embed#advanced-guide")])])}),[],!1,null,null,null);t.default=e.exports}}]);